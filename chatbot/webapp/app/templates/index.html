<!doctype html>
    <html lang="en">
      <head>
          <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <!-- Bootstrap CSS -->
        <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/style.css') }}"/>

        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css">
        <link href='https://fonts.googleapis.com/css?family=Oswald:400,300,700' rel='stylesheet' type='text/css'>
        <style>


        </style>

        <!-- <script src="{{ url_for('static', filename='js/custom.js')}}"></script> -->
        <title>Teaching Assistant</title>
      </head>
      <body>
        <h3 style="align-self:left"></h3>
        <br/>

          <div class="container h-100">
            <div class="container text-center">
            <h4 class="text-monospace"> Olivia Cortez - Your faithful TA for {{course_name}} Course</h4>
            </div>
            <div class="row align-items-center h-100">
                <div class="col-md-8 col-sm-12 mx-auto">

                    <div class="h-100 justify-content-center">

                        <div class="chat-container" style="overflow: auto; max-height: 55vh">
                          <div class="chat-message bot-message rcorners1" id="bMsg">

                            Hello, {{greeting}} {{name}}!! I am here to answer some of your questions related to your {{course_name}} course.
                          </div>


                    </div>
                    <form id="target">
                       <input class="input" type="text" value="" placeholder="Press 'Enter' after typing..." id="input_message"/>
                       <input type="submit" hidden>
                    </form>
                </div>

            </div>

        </div>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"></script>
        <script src="https://js.pusher.com/4.1/pusher.min.js"></script>
        <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js"></script>
        <script>
          var socket = io.connect('http://localhost:80');


          socket.on('answer',function(data) {
          // append the bot repsonse to the div


            $('.chat-container').append(`<div class="chat-message rcorners1 bot-message" id="bMsg">
            ${data.message}
            </div>`)
            $('.chat-container').scrollTop(1000);

            // remove the loading indicator
            $( "#loading" ).remove();
          });

              $('#target').on('submit', function(e){
                      e.preventDefault();
                      //alert("hi");
                      const input_message = $('#input_message').val()
                      // return if the user does not enter any text
                      if (!input_message) {
                        return
                      }

                      $('.chat-container').append(`
                          <div class="chat-message human-message humantext">
                          ${input_message}
                          </div>
                      `)

                      // loading
                      $('.chat-container').append(`
                          <div class="chat-message bot-message rcorners1" id="loading">
                              <b>...</b>
                          </div>
                      `)

                      // clear the text input
                      $('#input_message').val('')


                      // send the message
                      socket.emit('question',{question:input_message,email_id: "{{email_id}}", name: "{{name}}", course_id: "{{course_id}}" })
                      //submit_message(input_message)
                  });

        </script>

      </body>
    </html>
